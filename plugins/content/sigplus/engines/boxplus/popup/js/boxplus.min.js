/*
 boxplus: a lightweight pop-up window engine shipped with sigplus
 @author  Levente Hunyadi
 @version 1.4.3
 @remarks Copyright (C) 2009-2010 Levente Hunyadi
 @remarks Licensed under GNU/GPLv3, see http://www.gnu.org/licenses/gpl-3.0.html
 @see     http://hunyadi.info.hu/projects/boxplus
*/
if("undefined"==typeof __jQuery__)var __jQuery__=jQuery;
(function(c){function C(a,b){var d=parseInt(a.css(b));return isNaN(d)?a[b]():d}function r(a){return C(a,"width")}function H(a,b){return parseInt(a.css("margin-"+b))||0}function ya(a){var b=a.attr("src"),d=a.attr("longdesc");a=a.attr("data-thumb");return{src:a?a:b&&"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw=="!=b?b:/\.(gif|jpe?g|png)$/i.test(d)?d:!1}}function e(a,b){return c(".boxplus-"+a,b)}function X(a){a=c(a);h=c.extend({},Y,a.data("boxplus"));var b=h.theme;
b&&c("link[rel=stylesheet][title^=boxplus]").attr("disabled","disabled").filter('[title="boxplus-'+b+'"]').removeAttr("disabled");O.removeClass("boxplus-hidden");e("m",f).addClass("boxplus-hidden");e("title",f).addClass("boxplus-unavailable");f.removeClass("boxplus-disabled").css({width:P,height:Q}).css(Z(P,Q)).removeClass("boxplus-hidden");D(f,!0);R.bind("keydown",$);h.contextmenu||R.bind("contextmenu",I).bind("dragstart",I);m=(b=a.attr("rel"))?c('a[rel="'+b+'"]'):a;a=a.attr("href");var d=m.map(function(){return c(this).attr("href")}).get();
m=m.filter(function(a){return c.inArray(c(this).attr("href"),d)>=a});w=(ba=h.rtl)?"right":"left";k.empty().css({left:"auto",right:"auto"}).css(w,0);m.each(function(a){var b=c("img:first",this);c("<li />").append((b.size()?c("<img />").attr(ya(b)):c()).click(function(){n();u(a)})).appendTo(k)});x.removeClass("boxplus-disabled").each(function(){var a=c("ul",this);c(this).toggleClass("boxplus-unavailable",2>a.children().size())});b="outside"==h.thumbs;x.toggleClass("boxplus-disabled",!b).filter(l.children()).toggleClass("boxplus-disabled",
b);J.toggleClass("boxplus-unavailable",2>m.length||!h.slideshow);u(c.inArray(a,d))}function S(){n();R.unbind("keydown",$).unbind("contextmenu",I).unbind("dragstart",I);f.stop(!0,!0);g=-1;f.addClass("boxplus-disabled").add(E).add(l).add(O).addClass("boxplus-hidden")}function za(){n();u(0)}function T(){n();u(g-1)}function U(){n();u(g+1)}function Aa(){n();u(m.length-1)}function u(a){var b=m.length;if(a!=g&&(h.loop||0<=a&&a<b))g=(a+b)%b,ca(!0),da()}function n(){y&&(clearTimeout(y),y=0);K.addClass("boxplus-disabled");
J.removeClass("boxplus-disabled")}function Ba(){ea();J.addClass("boxplus-disabled");K.removeClass("boxplus-disabled")}function Ca(){n();ca(!F.hasClass("boxplus-hidden"));da()}function L(){l.addClass("boxplus-hidden");D(l,!1);D(f,!0);E.addClass("boxplus-hidden");var a=h.autofit,b={},d={},aa={};Da(a&&F.hasClass("boxplus-hidden"),b,d,aa);l.css(b);G.attr("src",m.eq(g).attr("href"));M.toggleClass("boxplus-unavailable",!a||!s||b.width==s.width&&F.hasClass("boxplus-hidden"));k.each(function(){c(this).children().removeClass("boxplus-active").eq(g).addClass("boxplus-active")});
e("m",f).addClass("boxplus-hidden");f.animate(c.extend(aa,d),h.duration,h.easing,Ea)}function Fa(){n();window.location.href=h.download(m.eq(g))}function fa(){n();l.children().slice(0,-1).toggleClass("boxplus-hidden")}function ga(a){var b=a.attr("id"),b=b?"boxplus-"+b:"boxplus";c("li",a).each(function(){c("a:first",this).attr("rel",b)});return c("a[rel="+b+"]",a)}function da(){y&&(clearTimeout(y),y=0);f.stop(!0,!0);k.stop();E.addClass("boxplus-hidden");D(l,!0);v.empty();ha.addClass("boxplus-unavailable");
var a=m.eq(g),b=a[0],d=a.attr("href"),e=b.pathname;c.boxplus.onchange(d,g);/^#/.test(d)?(v.append(c(d).clone().contents()),N()):/\.(txt|html?)$/i.test(e)?v.load(d,{},N):/\.(gif|jpe?g|png)$/i.test(e)?ia(a):/\.(mov|mpe?g|ogg|swf|webM|wmv)$/i.test(e)||/youtube\.com$/.test(b.hostname)?ja(a):c.ajax({url:d,success:function(b,c,e){b=e.getResponseHeader("Content-Type");/^text\/(plain|html)/.test(b)?v.load(d,{},N):/^image\/(gif|jpeg|png)/.test(b)?ia(a):/^application\/x-shockwave-flash/.test(b)&&ja(a)},type:"head"})}
function ia(a){var b=h.metadata(a);b&&v.append(0<=c.inArray(c.type(b),["boolean","number","string"])?b:b.clone());G.removeClass("boxplus-unavailable");c(s=new Image).load(L).error(N).attr("src",a.attr("href"))}function ja(a){for(var b=a.attr("href"),d={},e=a[0].search.replace(/^\?/,"").split("&"),f=0;f<e.length;f++)if(e[f]){var k=e[f].split("=");d[k[0]]=k[1]}e=parseInt(d.width)||640;d=parseInt(d.height)||480;d={width:e,height:d};a=a[0].pathname;/\.(ogg|webM)$/i.test(a)?V.attr(c.extend({src:b},d)).removeClass("boxplus-unavailable"):
(e="application/x-shockwave-flash",f="D27CDB6E-AE6D-11cf-96B8-444553540000",/\.mov$/i.test(a)&&(e="video/quicktime",f="02BF25D5-8C17-4B23-BC80-D3488ABDDC6B"),W.empty().append("<object"+ka(c.extend({classid:"clsid:"+f},d))+">"+Ga({movie:b})+"\x3c!--[if lt IE 9]>\x3c!--\x3e<object"+ka(c.extend({type:e,data:b},d))+"></object>\x3c!--<![endif]--\x3e</object>").removeClass("boxplus-unavailable"));s=c.extend({},d);L()}function ka(a){var b="",d;for(d in a)b+=" "+d+'="'+a[d]+'"';return b}function Ga(a){var b=
"",d;for(d in a)b+='<param name="'+d+'" value="'+a[d]+'" />';return b}function N(){s=null;L()}function Ea(){e("m",f).removeClass("boxplus-hidden");var a=z(k.children().eq(g));if(0>q){var b=r(x),d=r(k);k.css(w,-(d<b?z(k.children().eq(0)):Math.min(a,d-b)))}else q=g,k.css(w,-a);A();l.removeClass("boxplus-hidden");a=h.loop;la.toggleClass("boxplus-unavailable",!a&&0==g);ma.toggleClass("boxplus-unavailable",!a&&g>=m.length-1);l.children().removeClass("boxplus-hidden");a=s&&s.src;b=!v.is(":empty");na.toggleClass("boxplus-unavailable",
!h.download(m.eq(g)));oa.toggleClass("boxplus-unavailable",!a||!b);v.addClass("boxplus-hidden");a||!b||fa();D(f,!1);pa(f,!1);a={width:r(f)+e("sideways",f).trueWidth(),height:C(f,"height")+qa(f)};f.animate(a,h.duration,h.easing,function(){E.removeClass("boxplus-hidden");!h.loop&&g>=m.length-1&&n();K.hasClass("boxplus-disabled")||ea()})}function ea(){y=setTimeout(function(){u(g+1)},h.slideshow)}function z(a){var b=a.position().left;return ba?a.offsetParent().width()-a.width()-b:b}function A(){var a=
r(k.parent())-r(k),b=z(k);ra.toggleClass("boxplus-hidden",0<=b);sa.toggleClass("boxplus-hidden",0<a||b<=a)}function ta(){n();var a={};a[w]=-z(k.children().eq(q));k.animate(a,"fast","linear",A);return!1}function Ha(){0<q&&(q--,ta())}function Ia(){0<=q&&q+1<m.size()&&(q++,ta())}function Ja(){if(0>q){n();var a={};a[w]=0;k.animate(a,-4*z(k),"linear",A)}}function Ka(){if(0>q){n();var a=r(x),b=r(k),d=z(k),c=a-b;b+d<a?A():(a={},a[w]=c,k.animate(a,-4*(c-d),"linear",A))}}function ua(){k.stop();A()}function ca(a){e("enlarge",
M).toggleClass("boxplus-hidden",!a);F.toggleClass("boxplus-hidden",a)}function pa(a,b){var d=m.eq(g),c=h.title(d),d=h.description(d,b);e("title",a).toggleClass("boxplus-unavailable",!c).html(c);e("text",a).toggleClass("boxplus-unavailable",!d||d==c).empty().append(d)}function D(a,b){var c=e("progress",a).toggleClass("boxplus-hidden",!b);window.clearInterval(c.data("boxplus"));b&&c.data("boxplus",window.setInterval(function(){c.css("background-position",va=(va-32)%384)},150))}function qa(a){return e("caption",
a).trueHeight()+e("controls",a).trueHeight()}function Z(a,b){var d=window,e=document,f=e.documentElement,k=e.getElementsByTagName("body")[0],e=(d.innerWidth||f.clientWidth||k.clientWidth)/2,d=(d.innerHeight||f.clientHeight||k.clientHeight)/2,f=Math.max;return{left:f(0,c(window).scrollLeft()+e-a/2),top:f(0,c(window).scrollTop()+d-b/2)}}function Da(a,b,d,f){var h=window,g=document,m=g.documentElement,g=g.getElementsByTagName("body")[0],l=h.innerWidth||m.clientWidth||g.clientWidth,g=h.innerHeight||m.clientHeight||
g.clientHeight;c.extend(b,{width:s?s.width:wa,height:s?s.height:xa});pa(e("caption",p.removeClass("boxplus-unavailable")),!0);h=e("thumbs > ul",p);k.eq(0).children().clone().appendTo(h);e("thumbs",p).each(function(a){a=x.eq(a);c(this).toggleClass("boxplus-disabled",a.hasClass("boxplus-disabled")).toggleClass("boxplus-unavailable",a.hasClass("boxplus-unavailable"))});var m=e("sideways",p),n=e("main",p),n=n.trueWidth()-r(n)+m.trueWidth(),q=e("viewer",p.css("width",b.width+n)).css(b);if(a)for(var l=
l-H(B,"left")-H(B,"right"),t=p.outerWidth(!0);t>l;)t=l/t,b.width*=t,b.height*=t,q.css(b),t=p.css("width",b.width+n).outerWidth(!0);l=p.outerHeight(!0);if(a)for(a=g-H(B,"top")-H(B,"bottom");l>a;)t=a/l,b.width*=t,b.height*=t,q.css(b),l=p.css("width",b.width+n).outerHeight(!0);d.width=r(p)-m.trueWidth();d.height=C(p,"height")-qa(p);c.extend(f,Z(p.trueWidth(),l));h.empty();p.addClass("boxplus-unavailable")}function $(a){if(0>c.inArray(a.target.tagName.toLowerCase(),["input","textarea"]))return a=c.inArray(a.which,
[27,37,39,36,35]),0>a||[S,T,U,za,Aa][a](),!1}function I(a){return!c("img",k).add(G).filter(a.target).size()}var Y={rtl:!1,theme:!1,autofit:!0,slideshow:0,duration:"slow",easing:"swing",loop:!1,contextmenu:!0,thumbs:"inside",title:function(a){a=c("img:first",a);return a.size()?a.attr("alt"):""},description:function(a){return a.attr("title")},download:function(a){return!1},metadata:function(a){return""}},h,O,f,p,P,Q,wa,xa,l,G,v,V,W,ha,la,ma,J,K,na,oa,M,F,x,k,ra,sa,E,R=c(document),B,s,m,g=-1,va=0,q=
-1,y,ba,w;c.fn.trueWidth=function(){return this.filter(":visible").size()?this.outerWidth(!0):0};c.fn.trueHeight=function(){return this.filter(":visible").size()?this.outerHeight(!0):0};c(function(){function a(a,b){return"<div"+(a?' class="boxplus-'+(c.isArray(a)?a.join(" "):a)+'"':"")+">"+(b?b:"")+"</div>"}B=c("body");var b=a("prev")+a("next"),d=a("caption",a("title")+a("text")),h=a("controls",b+a("start")+a(["stop","boxplus-disabled"])+a("close")+a("download")+a("metadata")),g="<ul />"+a("rewind")+
a("forward"),b=c('<div id="boxplus">'+a(["background","boxplus-hidden"])+a(["dialog","boxplus-hidden"],a("title")+a("main",a(["viewer","boxplus-hidden"],a(["content","boxplus-hidden"])+"<img /><video controls />"+a("shockwave")+b+a("resizer",a("enlarge")+a(["shrink","boxplus-hidden"]))+a("thumbs",g)+a("progress"))+a("bottom",a("thumbs",g)+d+h))+a(["sideways","boxplus-disabled"],a("thumbs",g)+h+d)+a("lt")+a("t")+a("rt")+a("l")+a("m")+a("r")+a("lb")+a("b")+a("rb")+a("progress"))+"</div>").appendTo(B);
O=e("background",b).click(S);f=e("dialog",b);e("caption",f);E=e("bottom",f).add(e("sideways",f));l=e("viewer",f);v=c("div:first",l);G=c("img:first",l);V=c("video",l);W=e("shockwave",l);ha=c([G[0],W[0]]).add(V);M=e("resizer",l).click(Ca);F=e("shrink",M);ra=e("rewind",f).click(Ha).hover(Ja,ua);sa=e("forward",f).click(Ia).hover(Ka,ua);x=e("thumbs",f);k=c("ul",x);la=e("prev",f).click(T);ma=e("next",f).click(U);J=e("start",f).click(Ba);K=e("stop",f).click(n);e("close",f).click(S);na=e("download",f).click(Fa);
oa=e("metadata",f).click(fa);wa=r(f);xa=C(f,"height");l.css({height:0,width:0});P=r(f);Q=C(f,"height");p=f.clone().appendTo(b)});c.fn.boxplus=function(a){return this.boxplusConfigure(a).click(function(a){X(a.currentTarget);return!1})};c.fn.boxplusGallery=function(a){ga(this).boxplus(a);return this};c.fn.boxplusDialog=function(a){X(this.boxplusConfigure(a)[0])};c.fn.boxplusConfigure=function(a){this.data("boxplus",c.extend({},a));return this};c.fn.boxplusGalleryConfigure=function(a){ga(this).boxplusConfigure(a);
return this};c.boxplus={change:u,previous:T,next:U,refresh:L,configure:function(a){return c.extend(Y,a)},onchange:c.noop}})(__jQuery__);
