/*
 boxplus carousel engine
 @author  Levente Hunyadi
 @version 1.4.3
 @remarks Copyright (C) 2009-2010 Levente Hunyadi
 @remarks Licensed under GNU/GPLv3, see http://www.gnu.org/licenses/gpl-3.0.html
 @see     http://hunyadi.info.hu/projects/boxplus
*/
if("undefined"==typeof __jQuery__)var __jQuery__=jQuery;
(function(c){function u(a,b){return a+b}function r(a,b,f){var l=0;a.each(function(a,k){l=f(l,c(k)[b](!0))});return l}function D(a){function b(a){return("0"+a.toString(16)).slice(-2)}return"#"+b(Math.floor(255*a[3]))+b(a[0])+b(a[1])+b(a[2])}c.fn.maxOuterWidth=function(){return r(this,"outerWidth",Math.max)};c.fn.maxOuterHeight=function(){return r(this,"outerHeight",Math.max)};c.fn.totalOuterWidth=function(){return r(this,"outerWidth",u)};c.fn.totalOuterHeight=function(){return r(this,"outerHeight",
u)};c.fn.backColor=function(){function a(a,b){return c.map(a,function(a){return parseInt(a,b)})}var b=this.css("background-color"),f=[0,0,0],l=1;"transparent"==b&&(l=0);var d=b.match(/^#[\da-f]{6}$/i);if(d)var k=d[0],f=a([k.substr(1,2),k.substr(3,2),k.substr(5,2)],16);if(d=b.match(/^#([\da-f]{3})$/i))k=d[0],f=k.substr(1,1),d=k.substr(2,1),k=k.substr(3,1),f=a([f+f,d+d,k+k],16);(d=b.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/))&&(f=a(d.slice(1),10));if(d=b.match(/^rgba\((\d+),\s*(\d+),\s*(\d+)\,\s*(\d+(?:\.\d+)?)\)$/))f=
a(d.slice(1,-1),10),l=parseFloat(d[d.length-1]);f.push(l);return f};c.fn.effectiveBackColor=function(){var a=this;do var b=a.backColor(),a=a.parent();while(0==b[3]);return b};c.fn.boxplusCarousel=function(a){a=c.extend({rtl:!1,orientation:"horizontal",positioning:"side",edges:"sharp",navigation:"top",showButtons:!0,showLinks:!0,showOverlayButtons:!0,contextmenu:!0,scrollBy:1,duration:800,delay:0,opacity:1},a);var b="vertical"==a.orientation,f=a.windowSize?a.windowSize:b?400:"100%";this.filter("ul, ol").each(function(){function l(){0<
m.queue().length||k(a.scrollBy)}function d(){var a=0,c=0;if(A){var q=e.slice(0,t),d=e.eq(t);b?a=B/2-q.totalOuterHeight()-d.totalOuterHeight()/2:c=z/2-q.totalOuterWidth()-d.totalOuterWidth()/2}a={top:a};a[v]=c;return a}function k(y){if(y){var f=e[0<y?"first":"last"](),q=0<y?1:-1,g=0,g=A?b?e.eq(t).totalOuterHeight()/2+e.eq(t+q).totalOuterHeight()/2:e.eq(t).totalOuterWidth()/2+e.eq(t+q).totalOuterWidth()/2:b?f.totalOuterHeight():f.totalOuterWidth(),h=d();b?h.top-=q*g:h[v]-=q*g;m.animate(h,r,1<a.scrollBy?
"linear":"swing",function(){f.detach()[(0<q?"append":"prepend")+"To"](m);e=c("li:visible",m);e.css("top",0).css(v,0);m.css(d());k(q*(Math.abs(y)-1))})}}var r=a.duration,A="center"==a.positioning,v=n?"right":"left",m=c(this).wrap("<div />"),g=m.parent().addClass("boxplus-carousel").addClass("boxplus-disabled");g.wrapInner('<div class="boxplus-viewport" />');var e=c("li:visible",m),C=e.find("img:first").attr("src",function(a,b){var d=c(this).attr("longdesc");return/\.(gif|jpe?g|png)$/i.test(d)?d:b}),
t=e.size()/2,h=e.maxOuterWidth(),p=e.maxOuterHeight(),n=a.rtl;m.css({width:b?h:e.totalOuterWidth(),height:b?e.totalOuterHeight():p,left:n?"auto":0,right:n?0:"auto"});var h=b?h:f,p=b?f:p,p=c(".boxplus-viewport",g).css({width:h,height:p}),z=p.width(),B=p.height();p.css({width:z,height:B});g.css({width:z});if(1<e.size()&&g.width()>=z&&g.height()>=B){var h=function(a){return'<div class="boxplus-'+a+'" />'},n=function(a){return'<a class="boxplus-'+a+'" href="javascript:void(0)" />'},u=a.showButtons,E=
a.showLinks,n='<div class="boxplus-paging">'+(u?h("prev"):"")+(E?n("prev")+" ":"")+(E?" "+n("next"):"")+(u?h("next"):"")+"</div>";switch(a.navigation){case "both":g.prepend(n).append(n);break;case "top":g.prepend(n);break;default:g.append(n)}a.showOverlayButtons&&p.append(c(h("prev")+h("next")).addClass("boxplus-large "+(b?"boxplus-vertical":"boxplus-horizontal")));if("blurred"==a.edges){h=function(a){return'<div class="boxplus-edge boxplus-'+a+'" />'};p.append(c((A?h("start"):"")+h("end")).addClass(b?
"boxplus-vertical":"boxplus-horizontal"));var w=g.effectiveBackColor(),F=[w[0],w[1],w[2],0];c(".boxplus-edge",g).each(function(){var a=c(this);a.css("filter",function(a,b){if(b)return b.replace("#ff000000",D(w)).replace("#00000000",D(F))});a.css("background-image",function(a,b){if(b)return b.replace(/#000|#000000|rgb\(0,\s*0,\s*0\)|black/,"rgba("+w.join(",")+")").replace(/rgba\(0,\s*0,\s*0,\s*1\)|transparent/,"rgba("+F.join(",")+")")})})}m.css(d())}a.contextmenu||c(document).bind("contextmenu",function(a){return!C.filter(a.target).size()});
c(".boxplus-prev",g).click(function(){if(!(0<m.queue().length)){var c=e.last();b?c.css("top",-e.totalOuterHeight()):c.css(v,-e.totalOuterWidth());k(-a.scrollBy)}});c(".boxplus-next",g).click(l);g.removeClass("boxplus-disabled");m.css({visibility:"visible"});1>a.opacity&&(C.css("opacity",a.opacity),C.hover(function(){c(this).stop().animate({opacity:1},"slow")},function(){c(this).stop().animate({opacity:a.opacity},"slow")}));var x=a.delay;if(0<x){var x=Math.max(x,r),G=window.setInterval(l,x);g.mouseover(function(){window.clearInterval(G)}).mouseout(function(){G=
window.setInterval(l,x)})}});return this}})(__jQuery__);
